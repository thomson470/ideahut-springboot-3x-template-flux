const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/FormV-BNi_I15F.js","assets/format-CGhROzcI.js","assets/index-DHD4YuRL.js","assets/index-G0ic_0eP.css","assets/QTooltip-BF_G_uWg.js","assets/ClosePopup-BUscyfOW.js","assets/TouchPan-jmEJS9YP.js","assets/Index-CmRT2k02.js","assets/QSpace-1hX8bodH.js","assets/QTable-_w2CDqAD.js","assets/QInnerLoading-D79c4tOQ.js","assets/QSpinnerGears-u5VfzIwZ.js","assets/Table3-DPV_UO0o.js"])))=>i.map(i=>d[i]);
import{_ as S,ag as x,Y as v,a7 as m,$ as i,f as u,a0 as g,C as q,Z as p,ai as C,a1 as j,a4 as Q,a5 as F,a3 as w,a2 as k,F as h,a8 as V,aj as A,ah as E,al as D,r as b,am as I}from"./index-DHD4YuRL.js";import{Q as P,b as T,a as L}from"./format-CGhROzcI.js";import{Q as U}from"./QTooltip-BF_G_uWg.js";import{C as B}from"./ClosePopup-BUscyfOW.js";import{T as N}from"./TouchPan-jmEJS9YP.js";import{c as e}from"./Index-CmRT2k02.js";import"./QSpace-1hX8bodH.js";import"./QTable-_w2CDqAD.js";import"./QInnerLoading-D79c4tOQ.js";import"./QSpinnerGears-u5VfzIwZ.js";let o;const R={props:["parameters"],components:{FormV:x(()=>I(()=>import("./FormV-BNi_I15F.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11]))),Table3:x(()=>I(()=>import("./Table3-DPV_UO0o.js"),__vite__mapDeps([12,2,3,1,4,9,8,10,6,7,11])))},setup(){return{crud:e,title:b(null),fields:b([]),template:b(null),forms:b([]),tables:b([]),loading:b({}),replica:b(null),onlyView:b(!1),dialog:b({main:e.dialog.init(()=>o.dialog.main),form:e.dialog.init(),table:e.dialog.init()})}},created(){o=this;let a=e.get.object(o.parameters),r=e.get.object(a.row),n=e.get.object(a.definition);o.title=e.isString(a.title)?a.title:n.title,o.replica=e.get.number(a.replica,null),o.onlyView=a.onlyView==!0,o.fields=[];let l=e.get.array(n.table.columns),f,s=!1;for(const d of l)!s&&n.id.fields.includes(d.field)&&(s=!0),f=e.getFieldValue(d.field,r),e.isFunction(d.format)&&(f=d.format(f,r)),o.fields.push({label:d.label,value:f});if(!s){let d=e.id.toPk(n.id,r);e.isDefined(d)&&d!==null&&o.fields.splice(0,0,{label:"ID",value:d})}o.forms=e.get.array(n.forms),o.tables=e.get.array(n.children),o.definition=n},methods:{on_form_click(a,r){let n=e.get.object(o.parameters),l=e.get.object(n.definition),f=e.get.object(n.row),s=e.get.array(a.relations);if(!s.length){e.error("error.required","label.relation");return}let d=[];for(const t of s)d.push({field:t.target,condition:"EQUAL",value:e.getFieldValue(t.source,f)});let _=e.copy(a.crud);_.filters=e.isArray(_.filters)?_.filters:[],_.filters=_.filters.concat(d),e.isNumber(o.replica)&&(_.replica=o.replica),o.loading["form_"+r]=!0,e.api.call({path:"/crud/single",method:"post",data:_,onFinish(){o.loading["form_"+r]=!1},onSuccess(t){t=e.get.object(t),e.inject.pkAndGridId(a.id,t,l._grid_id_),e.dialog.show(o.dialog.form,{template:l,form:a,data:t,replica:o.replica})}})},on_table_click(a){let r=e.get.object(o.parameters),n=e.get.object(r.template),l=e.get.object(r.row),f=e.copy(e.get.array(a.relations));if(!f.length){e.error("error.required","label.relation");return}for(const s of f)s.value=e.getFieldValue(s.source,l);a._grid_id_=n._grid_id_,e.dialog.show(o.dialog.table,{template:n,definition:a,parentRow:l,relations:f,onlyView:e.isDefined(a.onlyView)?a.onlyView!==!1:r.onlyView,replica:o.replica})},on_close_dialog_table(){e.dialog.hide(o.dialog.table)}}},O={key:0},z={key:0},G={key:0,class:"q-mb-xs",style:{width:"100%"}},Y={key:1,class:"q-mb-xs",style:{width:"100%"}},Z={key:1},H={key:0,class:"q-mb-xs",style:{width:"100%"}},J={key:1,class:"q-mb-xs",style:{width:"100%"}};function K(a,r,n,l,f,s){const d=v("FormV"),_=v("Table3");return i(),m(h,null,[u(E,{style:j("width: "+(a.$q.screen.lt.md?"100%;":"50%;")+l.dialog.main.style)},{default:g(()=>[q((i(),p(C,{class:"q-pa-none header-main",style:j(l.crud.config?.color?.header?"background: "+l.crud.config.color.header+" !important;":"")},{default:g(()=>[u(P,{class:"q-pr-none"},{default:g(()=>[u(T,null,{default:g(()=>[u(L,{class:"text-h6 text-white"},{default:g(()=>[Q(F(l.title),1)]),_:1})]),_:1}),u(T,{side:""},{default:g(()=>[q((i(),p(w,{class:"text-caption text-white q-pl-xs q-pr-xs q-mr-xs",flat:"",round:"",glossy:"",icon:"close"},{default:g(()=>[u(U,null,{default:g(()=>[Q(F(a.$t("label.close")),1)]),_:1})]),_:1})),[[B]])]),_:1})]),_:1})]),_:1},8,["style"])),[[N,l.dialog.main.onDrag,void 0,{mouse:!0}]]),u(C,{style:{"max-height":"75vh"},class:"q-pa-xs q-mt-none scroll"},{default:g(()=>[(i(!0),m(h,null,V(l.fields,(t,c)=>(i(),p(A,{type:"text",key:c,label:t.label,modelValue:t.value,"onUpdate:modelValue":y=>t.value=y,readonly:"",filled:"",autogrow:"",class:"q-mb-xs",style:{"max-height":"200px",overflow:"scroll"}},null,8,["label","modelValue","onUpdate:modelValue"]))),128)),l.onlyView?(i(),m("div",O,[a.definition.childrenFirst?(i(),m("div",z,[l.tables.length?(i(),m("div",G,[(i(!0),m(h,null,V(l.tables,(t,c)=>(i(),p(w,{key:c,label:t.title,class:"full-width q-mt-xs q-mb-xs text-weight-bold","no-caps":"",glossy:"",onClick:y=>s.on_table_click(t)},null,8,["label","onClick"]))),128))])):k("",!0),l.forms.length?(i(),m("div",Y,[(i(!0),m(h,null,V(l.forms,(t,c)=>(i(),p(w,{key:c,label:t.title,class:"full-width q-mt-xs q-mb-xs text-weight-bold","no-caps":"",glossy:"",loading:l.loading["form_"+c],onClick:y=>s.on_form_click(t,c)},null,8,["label","loading","onClick"]))),128))])):k("",!0)])):(i(),m("div",Z,[l.forms.length?(i(),m("div",H,[(i(!0),m(h,null,V(l.forms,(t,c)=>(i(),p(w,{key:c,label:t.title,class:"full-width q-mt-xs q-mb-xs text-weight-bold","no-caps":"",glossy:"",loading:l.loading["form_"+c],onClick:y=>s.on_form_click(t,c)},null,8,["label","loading","onClick"]))),128))])):k("",!0),l.tables.length?(i(),m("div",J,[(i(!0),m(h,null,V(l.tables,(t,c)=>(i(),p(w,{key:c,label:t.title,class:"full-width q-mt-xs q-mb-xs text-weight-bold","no-caps":"",glossy:"",onClick:y=>s.on_table_click(t)},null,8,["label","onClick"]))),128))])):k("",!0)]))])):k("",!0)]),_:1})]),_:1},8,["style"]),u(D,{modelValue:l.dialog.form.show,"onUpdate:modelValue":r[0]||(r[0]=t=>l.dialog.form.show=t),persistent:"","transition-show":"slide-down","transition-hide":"none","backdrop-filter":"blur(1px)"},{default:g(()=>[u(d,{parameters:l.dialog.form.parameters},null,8,["parameters"])]),_:1},8,["modelValue"]),u(D,{modelValue:l.dialog.table.show,"onUpdate:modelValue":r[1]||(r[1]=t=>l.dialog.table.show=t),"transition-show":"slide-down","transition-hide":"none","backdrop-filter":"blur(1px)","full-height":""},{default:g(()=>[u(_,{parameters:l.dialog.table.parameters,onClose:s.on_close_dialog_table},null,8,["parameters","onClose"])]),_:1},8,["modelValue"])],64)}const re=S(R,[["render",K]]);export{re as default};
